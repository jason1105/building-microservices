## 第三章 如何建模微服务（领域和限界上下文）
### MusicCorp简介
一个在线零售商

### 什么样的服务是好服务
松耦合 & 高内聚
1. 松耦合：一个服务的修改不能影响其他服务。注意：服务间的过度通信也会导致紧耦合。
2. 高内聚：把相关的行为放在一起，不相关的放在其他地方。保证一个行为的修改不是分散的，因为分散带来的不仅是效率的问题，也导致更高的风险。

### 限界上下文
一个给定领域包含很多限界上下文，每个限界上下文中包含很多模型，这些模型又分成两部分，一部分与外界通信，一部分不与外界通信。（我起了名字叫子域），限界上下文有自己特定的接口，该接口决定将会暴露那些模型给其他的上下文。
1. 共享的隐藏模型：不同限界上下文之间交换数据的模型是一个共享模型，该模型属于某一个限界上下文，在其他上下文需要使用时暴露出去，该模型并非被完全暴露出去，而是具有内部和外部两种表示方式。（这样可以避免紧耦合）

`举个例子：仓库限界上下文、财务限界上下文`

2. 模块和服务：当发现领域内部的限界上下文，一定要使用模块对其进行建模，同时使用共享的隐藏模型。这些模块可以成为绝佳的微服务候选。微服务和限界上下文保持一致。
3. 过早划分：过早划分微服务的代价很高。而把现有代码库划分成为微服务则比从头构建简单的多。

### 业务功能
从功能考虑组织里的限界上下文，不要从数据角度考虑。先讨论“这个上下文是干什么用的”，然后再考虑“它需要什么样的数据”。

### 逐步划分上下文
划分更细粒度：

仓库上下文
- 订单处理上下文
- 货物接受上下文
- 库存管理上下文
![](http://a3.qpic.cn/psb?/V120cGPg1BkF5W/EyXWTvQPrl2zKlTEiit36clK7DIcPaOPxPe1MC1bmAI!/c/dJoAAAAAAAAA&ek=1&kp=1&pt=0&bo=OAQ4BDgEOAQBACc!&tl=1&tm=1536580800&sce=0-12-12&rf=0-18)


嵌套上下文利于测试，例如测试仓库服务的消费方，不需要对仓库上下文中的每个服务进行打桩。

### 关于业务概念的沟通
思考对业务概念的一致性认识，在组织内部共享的那些相同的术语和想法，也应该被反映到业务的接口上。

### 技术边界
按照技术接缝对边界进行建模不是首选的方案（水平切割）。

纵向的按照业务、组织结构、地理位置等对单块系统进行划分是合理的。

### 小结
Eric Evans《领域驱动设计》中提到了限界上下文

Vaughn Vernon《实现领域驱动设计》则对寻找边界提出了实践方法。


